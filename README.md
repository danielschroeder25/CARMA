### Overview
CARMA is our communication-avoiding recursive matrix multiplication algorithm. We use Cilk for the parallelism, and MKL for the base-case multiplication. Research in progress: [paper](http://www.eecs.berkeley.edu/Pubs/TechRpts/2012/EECS-2012-205.pdf), [poster](http://www.cs.berkeley.edu/~odedsc/papers/CARMA%20Poster-SC12).  

### Setup
1. Define the matrix sizes by editing the top of `sweeper.sh`.  
2. Define the number of threads by editing the top of `sweeper.sh`.  
3. Define the parameter sweep by editing the for loop at the bottom of `sweeper.sh`.  
4. Select between single and double precision by choosing a compilation line in the middle of `sweeper.sh`.  
5. Define carma's depth by editing the top of `carma.c` or `carma-single.c`.  

### Usage
```
bash runner.sh <num_trials> <alg...>
```
ex:
```
bash runner.sh 17 carma.c mkl.c
```
```
bash runner.sh 19 carma-single.c mkl-single.c
```

Then check ```data.csv``` for the results.

### Notes
*  Don't mix single and double precision in the same trial, and don't forget to edit the compilation in sweeper.sh when changing precision.  
*  It is recommended to use log2(# cores) for CARMA's depth.
*  To maintain simplicity, we don't handle the case where the largest dimension is not divisible by two. Therefore, to be safe, please only use powers of two (although it will work as long as all dimensions are divisible by 2^(depth)).  
*  The most interesting results are generated by "dot-product-like" dimensions, for example m = n = 64, k = 2^20 (we are multiplying an m x k matrix by a k x n matrix, and the result is m x n).  
*  For faster trials, ensure that the correctness test in `data_gatherer.c` is commented.  

### Making your own multiplication algorithm
*  Ensure that your file implements `void multiply(int m, int k, int n, float *A, float *B, float *C);`  
*  See carma.c and mkl.c for examples  

### Requirements
You must have Intel Parallel Studio XE installed, which will provide Cilk and MKL.  
On our machine, we source icc with `source /opt/intel/bin/iccvars.sh intel64`  

### Authors
David Eliahu, Omer Spillinger

### Mentors/Supervisors
Professor Armando Fox, Professor James Demmel, Benjamin Lipshitz, Oded Schwartz, Shoaib Kamil
